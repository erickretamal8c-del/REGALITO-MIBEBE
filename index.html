<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Para mi novia hermosa üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fuente bonita -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #ffd1f7 0, #ffb3d9 25%, #ff8ccf 50%, #ff5fa2 75%, #ff3b7f 100%);
      overflow: hidden;
      color: #4a154b;
    }

    /* Corazones flotando fondo */
    .hearts {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }

    .heart {
      position: absolute;
      width: 18px;
      height: 18px;
      background: white;
      opacity: .8;
      transform: rotate(-45deg);
      animation: floatUp 14s linear infinite;
    }

    .heart::before,
    .heart::after {
      content: "";
      position: absolute;
      width: 18px;
      height: 18px;
      background: inherit;
      border-radius: 50%;
    }

    .heart::before { top: -9px; left: 0; }
    .heart::after  { top: 0; left: 9px; }

    @keyframes floatUp {
      0% { transform: translateY(100vh) rotate(-45deg) scale(.8); opacity: 0; }
      20% { opacity: .9; }
      100% { transform: translateY(-10vh) rotate(-45deg) scale(1.2); opacity: 0; }
    }

    /* Corazones explosi√≥n (radiales) */
    .burst-heart {
      position: fixed;
      width: 18px;
      height: 18px;
      background: white;
      opacity: 1;
      transform: rotate(-45deg) scale(0.2);
      pointer-events: none;
      z-index: 10;
      transition: transform 0.7s ease-out, opacity 0.7s ease-out;
    }
    .burst-heart::before,
    .burst-heart::after {
      content: "";
      position: absolute;
      width: 18px;
      height: 18px;
      background: inherit;
      border-radius: 50%;
    }
    .burst-heart::before { top: -9px; left: 0; }
    .burst-heart::after  { top: 0; left: 9px; }

    /* Tarjeta inicial */
    .card {
      position: relative;
      z-index: 1;
      width: 95%;
      max-width: 420px;
      background: rgba(255, 255, 255, 0.94);
      border-radius: 28px;
      padding: 28px 24px;
      text-align: center;
      box-shadow: 0 18px 45px rgba(255, 0, 128, 0.3);
      backdrop-filter: blur(10px);
      transition: opacity .7s ease, transform .7s ease;
    }

    .card.fade-out {
      opacity: 0;
      transform: scale(.9) translateY(-30px);
      pointer-events: none;
    }

    .tag {
      background: rgba(255, 182, 220, .4);
      padding: 6px 14px;
      border-radius: 40px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: .8rem;
      color: #b1206d;
      margin-bottom: 12px;
    }

    .tag span { font-size: 1rem; }

    .photo-wrapper {
      width: 140px;
      height: 140px;
      margin: 0 auto 14px;
      border-radius: 50%;
      padding: 5px;
      background: conic-gradient(from 180deg, #ff8ccf, #ffe0f7, #ffb3d9);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 0 4px rgba(255,255,255,.9);
    }

    .photo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .title { font-size: 1.6rem; font-weight: 700; }
    .subtitle { margin: 8px 0 16px; font-size: .95rem; color: #7b3f7e; }
    .question { margin-bottom: 18px; font-size: 1.25rem; font-weight: 600; }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 24px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease, background .2s ease, opacity .2s ease;
    }

    #btn-yes {
      background: linear-gradient(135deg, #ff4fa3, #ff85c2);
      color: white;
      font-weight: 700;
    }

    #btn-yes:hover:not(:disabled) {
      transform: translateY(-1px) scale(1.05);
      box-shadow: 0 12px 26px rgba(255,0,150,.45);
    }

    #btn-no {
      background: #ffe5f4;
      color: #b1206d;
      font-weight: 600;
    }

    #message {
      min-height: 26px;
      color:#7b3f7e;
      font-size:.95rem;
    }

    /* VIAJE INTERMEDIO GIGANTE */
    #journey {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity .8s ease;
      background: radial-gradient(circle at top, rgba(255,192,224,0.15), rgba(10,0,25,0.9));
      z-index: 2;
    }
    #journey.active {
      opacity: 1;
      visibility: visible;
    }

    .journey-card {
      background: rgba(10, 0, 20, 0.9);
      border-radius: 26px;
      padding: 24px 20px 20px;
      max-width: 860px;
      width: 96%;
      color: #ffe9ff;
      box-shadow: 0 26px 60px rgba(0,0,0,.8);
      border: 1px solid rgba(255,255,255,.35);
      backdrop-filter: blur(12px);
    }

    .journey-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }

    .journey-title {
      font-size:1.4rem;
      font-weight:600;
      animation: heartBeat 1.8s ease-in-out infinite;
      transform-origin:center;
    }

    @keyframes heartBeat {
      0%,100% { transform:scale(1); }
      50% { transform:scale(1.03); }
    }

    .journey-subtitle {
      font-size:.9rem;
      color:#ffe2ff;
      opacity:.8;
      margin-bottom:8px;
    }

    .secret-btn {
      border-radius:999px;
      border:1px solid rgba(255,255,255,.4);
      background:rgba(255,255,255,.1);
      color:#ffeaff;
      font-size:.75rem;
      padding:4px 10px;
      cursor:pointer;
      white-space:nowrap;
    }

    .secret-text {
      font-size:.8rem;
      color:#ffeaff;
      margin-top:4px;
      min-height:20px;
      opacity:.9;
    }

    .journey-progress {
      display:flex;
      gap:8px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }

    .progress-step {
      flex:1;
      min-width:70px;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:.75rem;
      color:#d8b8ff;
      opacity:.7;
      cursor:pointer;
    }

    .progress-dot {
      width:10px;
      height:10px;
      border-radius:50%;
      border:2px solid #d8b8ff;
    }

    .progress-step.active {
      opacity:1;
      color:#ffd2ff;
    }
    .progress-step.active .progress-dot {
      background:#ff66c4;
      border-color:#ffb0f0;
      box-shadow:0 0 10px rgba(255,102,196,.8);
    }

    .journey-panels {
      margin-top:8px;
      min-height:220px;
    }

    .journey-panel {
      display:none;
      animation: panelIn .5s ease;
    }
    .journey-panel.active {
      display:block;
    }

    @keyframes panelIn {
      from { opacity:0; transform:translateY(10px); }
      to   { opacity:1; transform:translateY(0); }
    }

    /* Panel 1 - Recuerdos */
    .timeline {
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
    }
    .timeline-item {
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .timeline-dot {
      width:10px;
      height:10px;
      border-radius:50%;
      background:#ff66c4;
      margin-top:6px;
      box-shadow:0 0 10px rgba(255,102,196,.8);
    }
    .timeline-text-title {
      font-size:.95rem;
      font-weight:600;
      color:#ffe6ff;
    }
    .timeline-text-body {
      font-size:.85rem;
      color:#f8d6ff;
      opacity:.9;
    }

    /* Panel 2 - corazones */
    .hearts-grid {
      display:grid;
      grid-template-columns:repeat(3, minmax(0,1fr));
      gap:10px;
      margin-top:8px;
    }
    .love-heart-btn {
      background:rgba(255,255,255,.08);
      border-radius:18px;
      padding:10px 4px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(255,255,255,.18);
      cursor:pointer;
    }
    .love-heart-btn span {
      font-size:1.4rem;
      margin-bottom:4px;
    }
    .love-heart-btn small {
      font-size:.7rem;
      color:#ffe9ff;
      opacity:.8;
    }
    #heart-message {
      margin-top:12px;
      font-size:.9rem;
      text-align:center;
      color:#ffeaff;
      min-height:32px;
    }

    /* Panel 3 - Promesas */
    .promises {
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:10px;
    }
    .promise {
      background:rgba(255,255,255,.06);
      border-radius:16px;
      padding:8px 10px;
      border:1px solid rgba(255,255,255,.18);
      cursor:pointer;
      text-align:left;
    }
    .promise-title {
      font-size:.9rem;
      color:#ffeaff;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .promise-body {
      font-size:.8rem;
      color:#f1d4ff;
      margin-top:4px;
      display:none;
    }
    .promise.open .promise-body {
      display:block;
    }

    /* Panel 4 - Carta */
    #letter-text {
      margin-top:10px;
      font-size:.9rem;
      color:#ffeaff;
      min-height:80px;
      white-space:pre-line;
    }

    .journey-controls {
      margin-top:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .journey-buttons {
      display:flex;
      gap:8px;
    }
    .journey-buttons button {
      padding:8px 14px;
      font-size:.85rem;
    }

    .hint {
      font-size:.75rem;
      color:#f1cfff;
      opacity:.8;
    }

    /* FINAL */
    #final-screen {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 1s ease;
      overflow: hidden;
      background: radial-gradient(circle at center, rgba(0,0,0,.8), rgba(0,0,0,.95));
      z-index: 3;
    }

    #final-screen.active {
      opacity: 1;
      visibility: visible;
    }

    #final-photo {
      position:absolute;
      inset:0;
      margin:auto;
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.9));
      animation: zoom 16s ease-in-out infinite alternate;
      opacity:.98;
    }

    @keyframes zoom {
      0% { transform: scale(1.02); }
      100% { transform: scale(1.12); }
    }

    .final-overlay {
      position: relative;
      z-index: 3;
      background: radial-gradient(circle at top, rgba(255,255,255,.18), rgba(10,0,20,.9));
      padding: 26px 22px;
      border-radius: 26px;
      backdrop-filter: blur(12px);
      text-align: center;
      max-width: 650px;
      box-shadow: 0 20px 45px rgba(0,0,0,.85);
      border: 1px solid rgba(255,255,255,.35);
    }

    #final-message {
      font-size:1.35rem;
      font-weight:500;
      color:white;
      text-shadow:0 3px 15px rgba(0,0,0,.9);
      margin-bottom:10px;
    }

    .final-note {
      color:#ffd9f7;
      font-size:.95rem;
      opacity:.9;
    }

    .final-note span {
      display:inline-block;
      animation: blink 1.4s infinite;
    }

    @keyframes blink {
      0%,100%{opacity:.4; transform:translateY(0);}
      50%{opacity:1; transform:translateY(-1px);}
    }

    @media (max-width: 480px) {
      .card {
        padding: 22px 18px;
      }
      .photo-wrapper {
        width: 115px;
        height: 115px;
      }
      .question {
        font-size:1.15rem;
      }
      #final-message {
        font-size:1.1rem;
      }
    }
  </style>
</head>
<body>

  <!-- M√∫sica -->
  <audio id="bg-music" src="musica.mp3" preload="auto" loop></audio>

  <!-- Corazones fondo -->
  <div class="hearts">
    <div class="heart" style="left:8%;animation-delay:0s;animation-duration:13s;"></div>
    <div class="heart" style="left:22%;animation-delay:2s;animation-duration:16s;"></div>
    <div class="heart" style="left:40%;animation-delay:4s;animation-duration:15s;"></div>
    <div class="heart" style="left:60%;animation-delay:1s;animation-duration:18s;"></div>
    <div class="heart" style="left:78%;animation-delay:3s;animation-duration:14s;"></div>
    <div class="heart" style="left:90%;animation-delay:5s;animation-duration:17s;"></div>
  </div>

  <!-- Tarjeta preguntas -->
  <main class="card" id="main-card">
    <div class="tag">
      <span>üíå</span> para la ni√±a m√°s hermosa
    </div>

    <div class="photo-wrapper">
      <img id="main-photo" src="mifoto.jpg" alt="foto m√≠a" class="photo" />
    </div>

    <h1 class="title" id="title">mi amorcito üíï</h1>
    <p class="subtitle" id="subtitle">antes de seguir responde con sinceridad absoluta</p>
    <p class="question" id="question">¬øsoy lindo? ü•∫</p>

    <div class="buttons">
      <button id="btn-yes">s√≠ demasiado üòç</button>
      <button id="btn-no">no üòè</button>
    </div>

    <p id="message"></p>
  </main>

  <!-- VIAJE INTERMEDIO GIGANTE -->
  <section id="journey">
    <div class="journey-card">
      <div class="journey-header">
        <div>
          <h2 class="journey-title">un mini viaje por nosotros ‚ú®</h2>
          <p class="journey-subtitle" id="journey-subtitle">
            son solo algunas cosas que me gusta guardar contigo
          </p>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
          <span class="hint">puedes ir tocando y probando todo lo que veas</span>
          <button class="secret-btn" id="secret-btn">no toques esto</button>
        </div>
      </div>
      <p id="secret-text" class="secret-text"></p>

      <div class="journey-progress">
        <div class="progress-step active" data-step="1">
          <div class="progress-dot"></div>
          <span>recuerdos</span>
        </div>
        <div class="progress-step" data-step="2">
          <div class="progress-dot"></div>
          <span>cosas que amo</span>
        </div>
        <div class="progress-step" data-step="3">
          <div class="progress-dot"></div>
          <span>promesas</span>
        </div>
        <div class="progress-step" data-step="4">
          <div class="progress-dot"></div>
          <span>carta</span>
        </div>
      </div>

      <div class="journey-panels">
        <!-- Panel 1 -->
        <div class="journey-panel active" id="panel-1">
          <p>hay momentos tuyos que se me quedaron pegados en la cabeza y en el coraz√≥n</p>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-dot"></div>
              <div>
                <div class="timeline-text-title">ese primer d√≠a que hablamos bien</div>
                <div class="timeline-text-body">
                  ah√≠ ya sent√≠ que hab√≠a algo distinto en ti como si te conociera de antes de alguna forma
                </div>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-dot"></div>
              <div>
                <div class="timeline-text-title">alguno de nuestros momentos tontos</div>
                <div class="timeline-text-body">
                  cuando nos re√≠mos por cualquier cosa y todo deja de importar un ratito y solo existimos nosotros
                </div>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-dot"></div>
              <div>
                <div class="timeline-text-title">cuando me haces sentir en casa</div>
                <div class="timeline-text-body">
                  no importa d√≥nde estemos contigo siempre se siente un poco m√°s tranquilo todo
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel 2 -->
        <div class="journey-panel" id="panel-2">
          <p>cosas que amo de ti y a√∫n as√≠ me quedo corto</p>
          <div class="hearts-grid">
            <button class="love-heart-btn" data-text="me encanta c√≥mo se te iluminan los ojos cuando hablas de algo que te gusta">
              <span>‚ù§Ô∏è</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="amo cuando te r√≠es fuerte y ni siquiera intentas disimularlo">
              <span>üíó</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="tu forma de cuidar a la gente que quieres dice mucho de lo bonita que eres por dentro">
              <span>üíï</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="me gusta cuando te pones seria pero igual se te sale esa carita tierna">
              <span>üíû</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="amo cuando me cuentas cosas del d√≠a que seg√∫n t√∫ son tontas y para m√≠ son importantes porque te pasan a ti">
              <span>üíì</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="me encanta que seas t√∫ con todo incluso con lo que crees que es un defecto">
              <span>üíñ</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="me gusta la calma que siento cuando est√°s cerca">
              <span>üíò</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="me haces sentir que no tengo que ser perfecto para que me quieras">
              <span>üíù</span><small>toca</small>
            </button>
            <button class="love-heart-btn" data-text="me hace feliz saber que la persona que me gusta tanto eres t√∫">
              <span>üíü</span><small>toca</small>
            </button>
          </div>
          <p id="heart-message"></p>
        </div>

        <!-- Panel 3 -->
        <div class="journey-panel" id="panel-3">
          <p>unas promesas chiquitas pero de verdad</p>
          <div class="promises">
            <div class="promise">
              <div class="promise-title">
                <span>no desaparecer cuando m√°s me necesitas</span>
                <span>‚û§</span>
              </div>
              <div class="promise-body">
                quiero intentar estar incluso cuando no sepa qu√© decir aunque sea solo para escucharte
              </div>
            </div>
            <div class="promise">
              <div class="promise-title">
                <span>decirte las cosas de frente</span>
                <span>‚û§</span>
              </div>
              <div class="promise-body">
                quiero que sientas que conmigo puedes hablar claro y que yo tambi√©n voy a ser honesto contigo
              </div>
            </div>
            <div class="promise">
              <div class="promise-title">
                <span>recordarte lo incre√≠ble que eres</span>
                <span>‚û§</span>
              </div>
              <div class="promise-body">
                en los d√≠as lindos y sobre todo en los d√≠as feos quiero ser alguien que te recuerde lo valiosa que eres
              </div>
            </div>
          </div>
        </div>

        <!-- Panel 4 -->
        <div class="journey-panel" id="panel-4">
          <p>antes de la parte final quer√≠a dejarte algo un poco m√°s tranquilo</p>
          <p id="letter-text"></p>
        </div>
      </div>

      <div class="journey-controls">
        <div class="journey-buttons">
          <button id="prev-step">‚óÄ anterior</button>
          <button id="next-step">siguiente ‚ñ∂</button>
        </div>
        <button id="go-final" style="display:none; background:linear-gradient(135deg,#ff4fa3,#ff85c2);color:white;font-weight:600;">
          ver la sorpresa final ‚ú®
        </button>
      </div>
    </div>
  </section>

  <!-- Pantalla final -->
  <div id="final-screen">
    <img id="final-photo" src="" alt="foto nuestra">
    <div class="final-overlay">
      <p id="final-message"></p>
      <p class="final-note">
        qu√©date un ratito que cada 10 segundos cambia el mensaje y la foto <span>‚ô•</span>
      </p>
    </div>
  </div>

  <script>
    // ------- M√∫sica: empieza en primer click -------
    const music = document.getElementById("bg-music");
    let musicStarted = false;
    document.addEventListener("click", () => {
      if (!musicStarted) {
        music.volume = 0.45;
        music.play().catch(()=>{});
        musicStarted = true;
      }
    }, { once:true });

    // ------- Preguntas iniciales -------
    const btnYes = document.getElementById("btn-yes");
    const btnNo = document.getElementById("btn-no");
    const message = document.getElementById("message");
    const photo = document.getElementById("main-photo");
    const titleEl = document.getElementById("title");
    const subtitleEl = document.getElementById("subtitle");
    const questionEl = document.getElementById("question");
    const card = document.getElementById("main-card");

    const finalScreen = document.getElementById("final-screen");
    const finalMsg = document.getElementById("final-message");
    const finalPhoto = document.getElementById("final-photo");

    const journey = document.getElementById("journey");
    const journeySubtitle = document.getElementById("journey-subtitle");
    const secretBtn = document.getElementById("secret-btn");
    const secretText = document.getElementById("secret-text");

    let step = 1;
    let yesScale = 1;
    let noClickCount = 0;
    let finalIndex = 0;

    const noMessagesStep1 = [
      "mmm segura intenta de nuevo",
      "creo que necesitas lentes nuevos",
      "voy a hacer puchero hasta que digas que s√≠",
      "tu dedo se resbal√≥ prueba otra vez"
    ];

    const noMessagesStep2 = [
      "oye no hables as√≠ de mi princesa",
      "claramente alguien no se ha visto bien al espejo",
      "voy a tener que recordarte lo incre√≠ble que eres",
      "respuesta incorrecta intenta otra vez"
    ];

    const loveMessages = [
      "me encanta c√≥mo apareciste en mi vida sin que lo esperara",
      "gracias por aguantar mis rarezas y seguir qued√°ndote a mi lado",
      "pensar en ti me baja el ruido de la cabeza",
      "contigo todo lo simple se siente distinto",
      "tu risa se me qued√≥ como uno de mis sonidos favoritos",
      "eres la persona a la que quiero contarle lo bueno y lo malo",
      "me haces querer ser una mejor versi√≥n de m√≠",
      "sigo sin creer del todo la suerte que tengo contigo",
      "no tienes idea de cu√°nto te pienso en silencio",
      "gracias por cada mensaje y por cada ratito tuyo que compartes conmigo"
    ];

    const imageFiles = [
      "1.jpg","2.jpg","3.jpg","4.jpg","5.jpg",
      "6.jpg","7.jpg","8.jpg","9.jpg","10.jpg",
      "11.jpg","12.jpg","13.jpg","14.jpg","15.jpg",
      "16.jpg","17.jpg","18.jpg","19.jpg","20.jpg"
    ];

    btnNo.addEventListener("click", () => {
      if (btnNo.disabled) return;

      yesScale += 0.2;
      btnYes.style.transform = `scale(${yesScale})`;

      const arr = step === 1 ? noMessagesStep1 : noMessagesStep2;
      const msgText = arr[noClickCount % arr.length];
      noClickCount++;
      message.textContent = msgText;

      btnNo.animate(
        [
          { transform: "translateX(0)" },
          { transform: "translateX(-4px)" },
          { transform: "translateX(4px)" },
          { transform: "translateX(0)" },
        ],
        { duration: 180, iterations: 1 }
      );
    });

    btnYes.addEventListener("click", () => {
      if (step === 1) {
        step = 2;
        yesScale = 1;
        noClickCount = 0;
        btnYes.style.transform = "scale(1)";
        message.textContent = "ok ahora se pone interesante";

        photo.src = "ella.jpg";
        photo.alt = "mi ni√±a hermosa";

        titleEl.textContent = "ahora t√∫ üòè";
        subtitleEl.textContent = "pregunta importante responde con honestidad total";
        questionEl.textContent = "¬øt√∫ te consideras linda? üíñ";

        btnYes.textContent = "obvio que s√≠ üòå‚ú®";
        btnNo.textContent = "no para nada";

        explosionCorazones(10);
        explosionDesdeElemento(questionEl, 20);

      } else {
        // ella dice que s√≠: vamos al viaje intermedio gigante
        explosionDesdeElemento(questionEl, 40);
        iniciarViajeIntermedio();
      }
    });

    function iniciarViajeIntermedio() {
      btnYes.disabled = true;
      btnNo.disabled = true;

      card.classList.add("fade-out");

      setTimeout(() => {
        card.style.display = "none";
        journey.classList.add("active");
        iniciarJourney();
      }, 800);
    }

    // -------- VIAJE INTERMEDIO --------
    let currentJourneyStep = 1;
    const totalJourneySteps = 4;
    const panels = {
      1: document.getElementById("panel-1"),
      2: document.getElementById("panel-2"),
      3: document.getElementById("panel-3"),
      4: document.getElementById("panel-4")
    };
    const dots = document.querySelectorAll(".progress-step");
    const heartButtons = document.querySelectorAll(".love-heart-btn");
    const heartMessage = document.getElementById("heart-message");
    const promiseEls = document.querySelectorAll(".promise");
    const letterTextEl = document.getElementById("letter-text");
    const prevStepBtn = document.getElementById("prev-step");
    const nextStepBtn = document.getElementById("next-step");
    const goFinalBtn = document.getElementById("go-final");

    const letterText =
      "no siempre me sale perfecto decir las cosas\n" +
      "pero quiero que sepas que contigo todo vale un poco m√°s\n\n" +
      "me gusta la idea de seguir sumando momentos contigo\n" +
      "tranquilos tontos intensos normales todos esos\n\n" +
      "no eres alguien que simplemente pas√≥ por mi vida\n" +
      "para m√≠ eres alguien que quiero cuidar recordar y elegir";

    const subs = {
      1: "un repaso r√°pido por algunas cosas que se me quedaron guardadas contigo",
      2: "una parte muy chiquita de todo lo que me gusta de ti",
      3: "cosas que quiero que sepas y que quiero cuidar",
      4: "una mini carta para ti hecha con mucho cari√±o"
    };

    function iniciarJourney() {
      currentJourneyStep = 1;
      actualizarJourney();
      prepararInteraccionesJourney();
    }

    function actualizarJourney() {
      // actualizar dots
      dots.forEach(d => {
        const stepDot = Number(d.getAttribute("data-step"));
        d.classList.toggle("active", stepDot === currentJourneyStep);
      });

      journeySubtitle.textContent = subs[currentJourneyStep] || "";

      // mostrar panel correcto
      for (let i = 1; i <= totalJourneySteps; i++) {
        panels[i].classList.toggle("active", i === currentJourneyStep);
      }

      // botones navegaci√≥n
      prevStepBtn.disabled = currentJourneyStep === 1;
      nextStepBtn.style.display = currentJourneyStep === totalJourneySteps ? "none" : "inline-block";
      goFinalBtn.style.display = currentJourneyStep === totalJourneySteps ? "inline-block" : "none";

      if (currentJourneyStep === 4) {
        escribirCarta();
      }
    }

    prevStepBtn.addEventListener("click", () => {
      if (currentJourneyStep > 1) {
        currentJourneyStep--;
        actualizarJourney();
        explosionDesdeElemento(journey, 12);
      }
    });

    nextStepBtn.addEventListener("click", () => {
      if (currentJourneyStep < totalJourneySteps) {
        currentJourneyStep++;
        actualizarJourney();
        explosionDesdeElemento(journey, 16);
      }
    });

    dots.forEach(d => {
      d.addEventListener("click", () => {
        const s = Number(d.getAttribute("data-step"));
        if (s >= 1 && s <= totalJourneySteps) {
          currentJourneyStep = s;
          actualizarJourney();
          explosionDesdeElemento(d, 12);
        }
      });
    });

    goFinalBtn.addEventListener("click", () => {
      explosionDesdeElemento(letterTextEl, 36);
      iniciarFinalRomantico();
    });

    function prepararInteraccionesJourney() {
      // corazones panel 2
      heartButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const text = btn.getAttribute("data-text") || "";
          heartMessage.textContent = text;
          explosionDesdeElemento(btn, 18);
        });
      });

      // promesas panel 3
      promiseEls.forEach(p => {
        p.addEventListener("click", () => {
          p.classList.toggle("open");
          explosionDesdeElemento(p, 14);
        });
      });

      // bot√≥n secreto
      let secretShown = false;
      secretBtn.addEventListener("click", () => {
        if (!secretShown) {
          secretText.textContent = "si llegaste hasta ac√° ley√©ndome as√≠ de cerca es porque de verdad me importas mucho m√°s de lo que digo y eso ya te hace demasiado especial para m√≠";
          secretShown = true;
        } else {
          secretText.textContent = "";
          secretShown = false;
        }
        explosionDesdeElemento(secretBtn, 24);
      });
    }

    // escribir carta tipo m√°quina
    let letterIndex = 0;
    let letterInterval = null;

    function escribirCarta() {
      letterTextEl.textContent = "";
      letterIndex = 0;
      if (letterInterval) clearInterval(letterInterval);

      letterInterval = setInterval(() => {
        letterTextEl.textContent = letterText.slice(0, letterIndex);
        letterIndex++;
        if (letterIndex > letterText.length) {
          clearInterval(letterInterval);
        }
      }, 35);
    }

    // -------- FINAL --------
    function iniciarFinalRomantico() {
      journey.classList.remove("active");
      finalScreen.classList.add("active");
      finalIndex = 0;
      actualizarMensajeEImagen();
      setInterval(actualizarMensajeEImagen, 10000);
    }

    function actualizarMensajeEImagen() {
      const msg = loveMessages[finalIndex % loveMessages.length];
      const img = imageFiles[finalIndex % imageFiles.length];

      finalMsg.textContent = msg;
      finalPhoto.style.opacity = 0;

      setTimeout(() => {
        finalPhoto.src = img;
        finalPhoto.animate(
          [
            { opacity: 0, transform: "scale(1.05)" },
            { opacity: 1, transform: "scale(1.12)" }
          ],
          { duration: 900, easing: "ease-out" }
        );
        finalPhoto.style.opacity = 1;
      }, 150);

      explosionCorazones(6);
      explosionDesdeElemento(finalMsg, 24);

      finalIndex++;
    }

    // -------- Corazones extras --------
    function explosionCorazones(cantidad) {
      for (let i = 0; i < cantidad; i++) {
        crearCorazonInstantaneo();
      }
    }

    function crearCorazonInstantaneo() {
      const h = document.createElement("div");
      h.classList.add("heart");
      h.style.left = Math.random() * 100 + "%";
      h.style.bottom = "0";
      h.style.animationDuration = 6 + Math.random() * 4 + "s";
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 11000);
    }

    // Explosi√≥n radial desde elemento
    function explosionDesdeElemento(elemento, cantidad) {
      const rect = elemento.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      for (let i = 0; i < cantidad; i++) {
        const heart = document.createElement("div");
        heart.classList.add("burst-heart");
        heart.style.left = cx + "px";
        heart.style.top = cy + "px";
        document.body.appendChild(heart);

        const angle = Math.random() * Math.PI * 2;
        const distance = 60 + Math.random() * 140;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;

        requestAnimationFrame(() => {
          heart.style.transform = `translate(${dx}px, ${dy}px) rotate(-45deg) scale(1.1)`;
          heart.style.opacity = 0;
        });

        setTimeout(() => heart.remove(), 800);
      }
    }
  </script>
</body>
</html>
